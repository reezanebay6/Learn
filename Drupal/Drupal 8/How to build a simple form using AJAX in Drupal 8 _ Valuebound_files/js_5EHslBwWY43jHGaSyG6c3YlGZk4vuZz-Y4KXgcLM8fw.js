(function(t,e){'function'===typeof define&&define.amd?define(e):'object'===typeof exports?module.exports=e():t.Blazy=e()})(this,function(){function f(t){var e=t._util;e.elements=g(t.options);e.count=e.elements.length;e.destroyed&&(e.destroyed=!1,t.options.container&&o(t.options.container,function(t){n(t,'scroll',e.validateT)}),n(window,'resize',e.saveViewportOffsetT),n(window,'resize',e.validateT),n(window,'scroll',e.validateT));p(t)};function p(t){for(var r=t._util,s=0;s<r.count;s++){var c=r.elements[s],n;s:{var o=c;n=t.options;var l=o.getBoundingClientRect();if(n.container&&u&&(o=o.closest(n.containerClass))){o=o.getBoundingClientRect();n=i(o,e)?i(l,{top:o.top-n.offset,right:o.right+n.offset,bottom:o.bottom+n.offset,left:o.left-n.offset}):!1;break s};n=i(l,e)};if(n||a(c,t.options.successClass))t.load(c),r.elements.splice(s,1),r.count--,s--};0===r.count&&t.destroy()};function i(t,e){return t.right>=e.left&&t.bottom>=e.top&&t.left<=e.right&&t.top<=e.bottom};function d(e,i,u){if(!a(e,u.successClass)&&(i||u.loadInvisible||0<e.offsetWidth&&0<e.offsetHeight))if(i=e.getAttribute(s)||e.getAttribute(u.src)){i=i.split(u.separator);var p=i[l&&1<i.length?1:0],h=e.getAttribute(u.srcset),g='img'===e.nodeName.toLowerCase(),w=(i=e.parentNode)&&'picture'===i.nodeName.toLowerCase();if(g||void 0===e.src){var f=new Image,d=function(){u.error&&u.error(e,'invalid');c(e,u.errorClass);t(f,'error',d);t(f,'load',m)},m=function(){g?w||v(e,p,h):e.style.backgroundImage='url("'+p+'")';r(e,u);t(f,'load',m);t(f,'error',d)};w&&(f=e,o(i.getElementsByTagName('source'),function(t){var e=u.srcset,o=t.getAttribute(e);o&&(t.setAttribute('srcset',o),t.removeAttribute(e))}));n(f,'error',d);n(f,'load',m);v(f,p,h)}
else e.src=p,r(e,u)}
else'video'===e.nodeName.toLowerCase()?(o(e.getElementsByTagName('source'),function(t){var e=u.src,o=t.getAttribute(e);o&&(t.setAttribute('src',o),t.removeAttribute(e))}),e.load(),r(e,u)):(u.error&&u.error(e,'missing'),c(e,u.errorClass))};function r(t,e){c(t,e.successClass);e.success&&e.success(t);t.removeAttribute(e.src);t.removeAttribute(e.srcset);o(e.breakpoints,function(e){t.removeAttribute(e.src)})};function v(t,e,o){o&&t.setAttribute('srcset',o);t.src=e};function a(t,e){return-1!==(' '+t.className+' ').indexOf(' '+e+' ')};function c(t,e){a(t,e)||(t.className+=' '+e)};function g(t){var o=[];t=t.root.querySelectorAll(t.selector);for(var e=t.length;e--;o.unshift(t[e]));return o};function m(t){e.bottom=(window.innerHeight||document.documentElement.clientHeight)+t;e.right=(window.innerWidth||document.documentElement.clientWidth)+t};function n(t,e,o){t.attachEvent?t.attachEvent&&t.attachEvent('on'+e,o):t.addEventListener(e,o,{capture:!1,passive:!0})};function t(t,e,o){t.detachEvent?t.detachEvent&&t.detachEvent('on'+e,o):t.removeEventListener(e,o,{capture:!1,passive:!0})};function o(t,e){if(t&&e)for(var n=t.length,o=0;o<n&&!1!==e(t[o],o);o++);};function h(t,e,o){var n=0;return function(){var s=+new Date;s-n<e||(n=s,t.apply(o,arguments))}};var s,e,l,u;return function(i){if(!document.querySelectorAll){var a=document.createStyleSheet();document.querySelectorAll=function(t,e,o,n,s){s=document.all;e=[];t=t.replace(/\[for\b/gi,'[htmlFor').split(',');for(o=t.length;o--;){a.addRule(t[o],'k:v');for(n=s.length;n--;)s[n].currentStyle.k&&e.push(s[n]);a.removeRule(0)};return e}};var n=this,r=n._util={};r.elements=[];r.destroyed=!0;n.options=i||{};n.options.error=n.options.error||!1;n.options.offset=n.options.offset||100;n.options.root=n.options.root||document;n.options.success=n.options.success||!1;n.options.selector=n.options.selector||'.b-lazy';n.options.separator=n.options.separator||'|';n.options.containerClass=n.options.container;n.options.container=n.options.containerClass?document.querySelectorAll(n.options.containerClass):!1;n.options.errorClass=n.options.errorClass||'b-error';n.options.breakpoints=n.options.breakpoints||!1;n.options.loadInvisible=n.options.loadInvisible||!1;n.options.successClass=n.options.successClass||'b-loaded';n.options.validateDelay=n.options.validateDelay||25;n.options.saveViewportOffsetDelay=n.options.saveViewportOffsetDelay||50;n.options.srcset=n.options.srcset||'data-srcset';n.options.src=s=n.options.src||'data-src';u=Element.prototype.closest;l=1<window.devicePixelRatio;e={};e.top=0-n.options.offset;e.left=0-n.options.offset;n.revalidate=function(){f(n)};n.load=function(t,e){var n=this.options;void 0===t.length?d(t,e,n):o(t,function(t){d(t,e,n)})};n.destroy=function(){var e=this._util;this.options.container&&o(this.options.container,function(o){t(o,'scroll',e.validateT)});t(window,'scroll',e.validateT);t(window,'resize',e.validateT);t(window,'resize',e.saveViewportOffsetT);e.count=0;e.elements.length=0;e.destroyed=!0};r.validateT=h(function(){p(n)},n.options.validateDelay,n);r.saveViewportOffsetT=h(function(){m(n.options.offset)},n.options.saveViewportOffsetDelay,n);m(n.options.offset);o(n.options.breakpoints,function(t){if(t.width>=window.screen.width)return s=t.src,!1});setTimeout(function(){f(n)})}});;
